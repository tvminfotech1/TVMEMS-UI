<div class="admin-attendance-container">

  <!-- ðŸ§‘â€ðŸ’¼ ADMIN VIEW -->
  <div *ngIf="isAdmin" class="admin-view">
    <!-- Title -->
    <h2>Attendance</h2>

    <!-- Filters -->
    <div class="filters">
      <input
        type="text"
        placeholder="Search by Employee ID"
        [(ngModel)]="filterEmpId"
        (input)="applyFilters()"
      />

      <input
        type="text"
        placeholder="Search by Name"
        [(ngModel)]="filterName"
        (input)="applyFilters()"
      />

      <div class="month-input-wrapper">
        <input
          type="month"
          [(ngModel)]="filterMonth"
          (change)="applyFilters()"
          id="monthInput"
          [max]="today"
        />
      </div>
    </div>

    <!-- ðŸ§¾ Admin Attendance Table -->
    <div class="table-wrapper">
      <table mat-table [dataSource]="employees" class="mat-elevation-z8 full-width-table">
        <!-- Employee ID -->
        <ng-container matColumnDef="employeeId">
          <th mat-header-cell *matHeaderCellDef>Employee ID</th>
          <td mat-cell *matCellDef="let element">{{ element.employeeId }}</td>
        </ng-container>

        <!-- Name -->
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let element">{{ element.fullName }}</td>
        </ng-container>

        <!-- Department -->
        <ng-container matColumnDef="department">
          <th mat-header-cell *matHeaderCellDef>Department</th>
          <td mat-cell *matCellDef="let element">{{ element.department }}</td>
        </ng-container>

        <!-- Designation -->
        <ng-container matColumnDef="designation">
          <th mat-header-cell *matHeaderCellDef>Designation</th>
          <td mat-cell *matCellDef="let element">{{ element.designation }}</td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let element">
            <button
              mat-raised-button
              color="primary"
              (click)="openDialog(element.employeeId)"
            >
              View
            </button>
          </td>
        </ng-container>

        <!-- Header & Rows -->
        <tr mat-header-row *matHeaderRowDef="adminDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: adminDisplayedColumns;"></tr>
      </table>
    </div>
  </div>

  <!-- ðŸ‘©â€ðŸ’» USER VIEW -->
  <div *ngIf="isUser" class="user-view">
    <!-- Title -->
    <h2>My Attendance</h2>

    <!-- Filters -->
    <div class="filters">
      <div class="month-input-wrapper">
        <input
          type="month"
          [(ngModel)]="filterMonth"
          (change)="applyFilters()"
          id="monthInput"
          [max]="today"
        />
      </div>
    </div>

    <!-- Attendance Table -->
    <div class="table-wrapper">
      <table class="full-width-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Entry Time</th>
            <th>Remarks</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let att of employeeAttendance">
            <td>{{ att.date | date }}</td>
            <td>
              {{ att.entryTime === '-' ? '-' : (convertToDateTime(att.entryTime) | date: 'shortTime') }}
            </td>
            <td>{{ att.remarks || '-' }}</td>
            <td
              [ngClass]="{
                'status-present': att.status === 'Present',
                'status-holiday': att.status === 'Holiday',
                'status-absent': att.status === 'Absent',
                'status-pending': att.status === 'Pending'
              }"
            >
              {{ att.status }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ðŸªŸ Attendance Details Dialog -->
  <ng-template #attendanceDialog>
    <h2 mat-dialog-title>
      Attendance - {{ selectedEmployee?.fullName }} ({{ selectedMonthName }})
    </h2>

    <mat-dialog-content>
      <div class="table-wrapper">
        <table class="mat-elevation-z8 full-width-table attendance-dialog-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Day</th>
              <th>Entry Time</th>
              <th>Remarks</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let a of employeeAttendance">
              <td>{{ a.date | date }}</td>
              <td>{{ a.date | date: 'EEEE' }}</td>
              <td>
                {{ a.entryTime === '-' ? '-' : (convertToDateTime(a.entryTime) | date: 'shortTime') }}
              </td>
              <td>{{ a.remarks }}</td>
              <td
                [ngClass]="{
                  'status-present': a.status === 'Present',
                  'status-holiday': a.status === 'Holiday',
                  'status-absent': a.status === 'Absent',
                  'status-pending': a.status === 'Pending'
                }"
              >
                {{ a.status }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </mat-dialog-content>
  </ng-template>
</div>

<div class="app-container">

  <!-- Header Tabs -->
  <header class="header">
    <nav class="tabs" role="tablist">
      <button class="tab" [class.active]="activeTab === 'business'" (click)="setActiveTab('business')">
        Business Unit Org Chart
      </button>
      <button class="tab" [class.active]="activeTab === 'reporting'" (click)="setActiveTab('reporting')">
        Reporting Structure
      </button>
      <button class="tab" [class.active]="activeTab === 'directory'" (click)="setActiveTab('directory')">
        Organization Directory
      </button>
    </nav>
  </header>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading employees...</p>
  </div>

  <!-- BUSINESS & REPORTING VIEW -->
  <div *ngIf="!isLoading && activeTab !== 'directory'" class="org-chart-container">

    <!-- Department Info -->
    <div class="department-card" *ngIf="activeTab === 'business'">
      <h3>{{ teamDepartment }}</h3>
      <p>Head by {{ departmentHead }}</p>
      <small>Department</small>
    </div>

    <!-- Employee Grid -->
    <div class="employees-grid" *ngIf="getVisibleEmployees().length; else noEmployees">
      <div class="employee-card" *ngFor="let emp of getVisibleEmployees()" (click)="selectEmployee(emp)">
        <div class="employee-photo">
          <img [src]="emp.photo" [alt]="emp.name">
        </div>
        <h4>{{ emp.name }}</h4>
        <p class="designation">{{ emp.designation }}</p>
        <p class="location">{{ emp.location }}</p>
        <p class="team" *ngIf="emp.team">{{ emp.team }}</p>
      </div>
    </div>

    <ng-template #noEmployees>
      <div class="empty-state">
        <p>No employees found.</p>
      </div>
    </ng-template>
  </div>

  <!-- DIRECTORY VIEW -->
  <div *ngIf="!isLoading && activeTab === 'directory'" class="directory-container">

    <!-- Add New Employee Form -->
    <form class="add-employee-form" (ngSubmit)="aaddEmployee()">
      <h3>Add New Employee</h3>
      <input type="text" placeholder="Name" [(ngModel)]="newEmployee.name" name="name" required>
      <input type="email" placeholder="Email" [(ngModel)]="newEmployee.email" name="email" required>
      <input type="text" placeholder="Department" [(ngModel)]="newEmployee.department" name="department" required>
      <input type="text" placeholder="Designation" [(ngModel)]="newEmployee.designation" name="designation" required>
      <input type="text" placeholder="Location" [(ngModel)]="newEmployee.location" name="location" required>
      <input type="text" placeholder="Photo URL" [(ngModel)]="newEmployee.photo" name="photo" required>
      <button type="submit" class="action-btn">Add Employee</button>
    </form>

    <!-- Search & Sort -->
    <div class="search-section">
      <div class="search-box">
        <input type="text" placeholder="Search by Name / ID" [(ngModel)]="searchTerm" (input)="filterEmployees()">
        <i class="search-icon">üîç</i>
      </div>
      <div class="sort-options">
        <select [(ngModel)]="sortBy" (change)="sortEmployees()">
          <option value="name">Sort by Name</option>
          <option value="department">Sort by Department</option>
          <option value="designation">Sort by Designation</option>
        </select>
      </div>
    </div>

    <!-- Directory List -->
    <div class="employee-list" *ngIf="filteredEmployees.length; else noResults">
      <div class="employee-row" *ngFor="let emp of filteredEmployees" (click)="selectEmployee(emp)">
        <div class="employee-info">
          <div class="employee-photo-small">
            <img [src]="emp.photo" [alt]="emp.name">
          </div>
          <div class="employee-details">
            <h4>{{ emp.name }}</h4>
            <p>ID: {{ emp.id }}</p>
            <p>Location: {{ emp.location }}</p>
          </div>
        </div>
        <div class="employee-contact">
          <p>Email: {{ emp.email }}</p>
          <p>Department: {{ emp.department }}</p>
        </div>
        <div class="employee-role">
          <p>{{ emp.designation }}</p>
        </div>
      </div>
    </div>

    <ng-template #noResults>
      <div class="empty-state">
        <p>No matching employees found.</p>
      </div>
    </ng-template>
  </div>

  <!-- Detail Modal -->
  <div *ngIf="selectedEmployee" class="employee-detail-overlay">
    <div class="employee-detail-card">
      <button class="close-btn" (click)="closeEmployeeDetail()">√ó</button>
      <div class="employee-photo-large">
        <img [src]="selectedEmployee.photo" [alt]="selectedEmployee.name">
      </div>
      <h3>{{ selectedEmployee.name }}</h3>
      <p>{{ selectedEmployee.location }}</p>
      <p>{{ selectedEmployee.department }}</p>
      <p class="designation-large">{{ selectedEmployee.designation }}</p>
      <p *ngIf="selectedEmployee.email">üìß {{ selectedEmployee.email }}</p>
    </div>
  </div>

</div>

<div class="timesheet-classic-container">
  <div class="classic-dropdown-section">
    <div class="classic-form-group">
      <label for="year">Year:</label>
      <select
        id="year"
        name="year"
        [(ngModel)]="timelog.year"
        (change)="onMonthOrYearChange()"
        required>
        <option *ngFor="let y of years" [value]="y">{{ y }}</option>
      </select>
    </div>

    <div class="classic-form-group">
      <label for="month">Month:</label>
      <select
        id="month"
        name="month"
        [(ngModel)]="timelog.month"
        (change)="onMonthOrYearChange()"
        required>
        <option value disabled>Select Month</option>
        <option *ngFor="let m of months" [value]="m">{{ m }}</option>
      </select>
    </div>

    <div class="classic-form-group">
      <label for="weekendDate">Select Week (sunday):</label>
      <select
        id="weekendDate"
        name="weekendDate"
        [(ngModel)]="timelog.weekendDate"
        (change)="onWeekendDateSelect()"
        required>
        <option
          *ngFor="let date of weekendDates"
          [value]="date"
          [disabled]="isWeekendDateDisabled(date) && !isAdmin">
          {{  date | date:'dd-MM-yyyy'  }} <span *ngIf="isWeekendDateDisabled(date) && !isAdmin">(Not
            available)</span>
        </option>
      </select>
    </div>

    <div class="classic-form-group">
      <label for="employeeName">Employee Name:</label>
      <input
        type="text"
        id="employeeName"
        name="employeeName"
        [(ngModel)]="timelog.employeeName"
        readonly />
    </div>

    <div class="classic-form-group">
      <label for="employeeId">Employee ID:</label>
      <input
        type="text"
        id="employeeId"
        name="employeeId"
        [(ngModel)]="timelog.employeeId"
        readonly />
    </div>
  </div>

  <div *ngIf="latestEntry && isUser" class="latest-entry-section">
    <h3>Latest Submitted Entry (Current Week)</h3>
    <table class="classic-table">
      <thead>
        <tr>
          <th>Project</th>
          <th>Total Hrs.</th>
          <th>Description</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ latestEntry.project }}</td>
          <td>{{ latestEntry.totalhours }}</td>
          <td>{{ latestEntry.description }}</td>
          <td>
            <span [ngClass]="{
               'status-pending': (latestEntry.status ?? '').trim().toLowerCase() === 'pending',
                'status-approved': (latestEntry.status ?? '').trim().toLowerCase() === 'approved',
                'status-rejected': (latestEntry.status ?? '').trim().toLowerCase() === 'rejected'
            }">{{ latestEntry.status }}</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>


  <div class="classic-accordion">
    <div class="accordion-item">
      <h2 class="accordion-header" (click)="toggleAccordion(0)">Timesheet
        Summary
        <span
          [style.transform]="accordionState[0]? 'rotate(180deg)' : 'rotate(0deg)'"
          style="display: inline-block; transition: 0.3s;">⯆

        </span>
      </h2>
      <div class="accordion-content" *ngIf="accordionState[0]">
        <table class="classic-table">
          <thead>
            <tr>
              <th>Employee Name</th>
              <th>Employee ID</th>
              <th>Project</th>
              <th>Week End Date</th>
              <th>Total Hrs.</th>
              <th>Description</th>
              <th>Status</th>
              <th *ngIf="isAdmin">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entry of timelogSummary">
              <td>{{ entry.employeeName }}</td>
              <td>{{ entry.employeeId }}</td>
              <td>{{ entry.project }}</td>
              <td>{{ entry.weekendDate  | date:'dd-MM-yyyy'  }}</td>
              <td>{{ entry.totalhours }}</td>
              <td>{{ entry.description }}</td>
              <td>
                <span [ngClass]="{
                  'status-pending': (entry.status ?? '').trim().toLowerCase() === 'pending',
                  'status-approved': (entry.status ?? '').trim().toLowerCase() === 'approved',
                  'status-rejected': (entry.status ?? '').trim().toLowerCase() === 'rejected'
                  
                }">{{ entry.status }}</span>
              </td>
              <td *ngIf="isAdmin">
                <button
                  *ngIf="entry.status !== 'Approved'"
                  class="action-btn approve-btn"
                  (click)="updateTimesheetStatus(entry, 'Approved')">
                  Approve
                </button>
                <button
                  *ngIf="entry.status !== 'Rejected'"
                  class="action-btn reject-btn"
                  (click)="updateTimesheetStatus(entry, 'Rejected')">
                  Reject
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="accordion-item">
      <h2 class="accordion-header" (click)="toggleAccordion(2)">Fill Your
        Timesheet
        <span
          [style.transform]="accordionState[2]? 'rotate(180deg)' : 'rotate(0deg)'"
          style="display: inline-block; transition: 0.3s;">⯆</span></h2>
      <div class="accordion-content" *ngIf="accordionState[2]">
        <form #timelogForm="ngForm" (ngSubmit)="onSubmit(timelogForm)" autocomplete="off">
          <table class="classic-table">
            <thead>
              <tr>
                <th>Project</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Total Hrs.</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <input type="text"
                    name="project"
                    [(ngModel)]="timelogEntry.project"
                    placeholder="Enter Project Name"
                    class="form-control"
                    required
                    [disabled]="entryExistsForWeek || isAdmin"  />

                </td>
                <td
                  *ngFor="let day of ['monday','tuesday','wednesday','thursday','friday']">
                  <select [name]="'hours' + day"
                    [(ngModel)]="timelogEntry.hours![day]"
                    (change)="calculateTotalHours()" required
                    [disabled]="entryExistsForWeek || isAdmin">
                    <option value>--select--</option>
                    <option value="WFO">WFO</option>
                    <option value="WFH">WFH</option>
                    <option value="Leave">Leave</option>
                    <option value="Holiday">Holiday</option>
                  </select>
                </td>

                <td>
                  <input type="text" name="totalHours"
                    [(ngModel)]="timelogEntry.totalhours" readonly />
                </td>
                <td>
                  <input type="text" name="description"
                    [(ngModel)]="timelogEntry.description" required
                    [disabled]="entryExistsForWeek || isAdmin" />
                </td>
              </tr>

            </tbody>
          </table>
          <br />
          <button
            type="submit"
            class="submit-btn"
            [disabled]="!timelogForm.valid || isFutureOrPastDateSelected || isAdmin">
            Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>